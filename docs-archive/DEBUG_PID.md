# NetShark 调试指南 - PID 不匹配问题

## 🔍 调试步骤

### 1. 重启服务以应用调试日志

```bash
# 按 Ctrl+C 停止当前服务
# 然后重新启动
npm start
```

### 2. 开始抓包测试

1. 在 NetShark 界面选择一个应用（如 Chrome、notepad.exe）
2. **记录前端显示的 PID**（如 `已选择: chrome.exe (PID: 12345)`）
3. 点击"开始会话"
4. **在该应用中产生网络流量**（如访问网站）

### 3. 查看后端日志

观察蓝色的 `[BACKEND]` 日志窗口，您会看到：

```
INFO:     Starting capture for PID 12345
INFO:     Refreshing port mapping for PID 12345...
INFO:     Target PID 12345 is using ports: {50123, 50124}
INFO:     Total active ports in system: 456
```

**如果抓到包**，会显示：
```
INFO:     [MATCHED] Packet for PID 12345: 192.168.1.1:50123 -> 8.8.8.8:443 (TCP)
```

---

## 🎯 诊断问题

### 问题1: 端口列表为空

```
INFO:     Target PID 12345 is using ports: set()
```

**原因**: 该进程还没有建立网络连接  
**解决**: 
- 等待应用完全启动
- 在应用中产生网络活动（如打开网页）
- 然后再点击"开始会话"

---

### 问题2: 没有 `[MATCHED]` 日志

**原因**: 捕获的数据包不属于目标 PID  
**可能性**:
1. **子进程问题**: Chrome 等浏览器会创建多个子进程，流量可能在子进程中
2. **PID 选择错误**: 选择了错误的进程

**解决**:
1. 打开 Windows 任务管理器 → "详细信息"
2. 找到您选择的应用
3. **查看是否有多个同名进程**，记下所有 PID
4. 尝试选择不同的 PID

---

### 问题3: PID 与任务管理器不一致

**现象**: NetShark 显示 PID 12345，但任务管理器显示 67890

**原因**:
1. **应用重启**: 选择后应用崩溃并自动重启（PID 改变）
2. **多进程应用**: 选择了父进程，但流量在子进程

**解决**:
1. 确保应用稳定运行
2. 对于浏览器，尝试选择网络进程（通常 PID 更大）
3. 或在任务管理器中手动找到 PID，然后直接输入

---

## 📸 需要提供的信息

请截图或复制以下内容帮助我诊断：

1. **前端显示的 PID**
2. **后端日志中的**:
   - `Starting capture for PID XXX`
   - `Target PID XXX is using ports: {...}`
3. **任务管理器中该应用的 PID**（截图）

---

## ✅ 成功标志

如果一切正常，您会看到：
- ✅ 后端日志: `[MATCHED] Packet for PID ...`
- ✅ 前端界面: 实时显示数据包列表
- ✅ 蓝色/紫色/绿色的数据包在滚动

---

## 🛠️ 临时解决方案

如果无法抓到特定应用的包，可以尝试：

1. **选择浏览器测试**（流量最明显）
2. **访问 http://example.com**（产生 HTTP 流量）
3. **查看是否能捕获到任何包**
